function [fig]=plotERP24(data, condition_names)
%function plots ERP images from data matrix (2 d or 3 d array) and returns handle to the figure 
%inputs: data - 3d array 24 channels x samples x conditions
%        condition_names - cell array with character variables 
%output: fig - figure handle

% sanity check for input
validateattributes(data, {'numeric'}, {'3d','size',[24,NaN,NaN]})
cellfun(@(x) validateattributes(x, {'char'}, {'nonempty'}), condition_names)
channel_names={'F3','Fz','F4','FC5','FC1','FC2','FC6','C3','Cz','C4','CP5','CP1',...
    'CP2','CP6','P7','P3','Pz','P4','P8','PO7','POz','PO8','O1','O2','EOG','A1'}; %EOG, A1-not to plot
%suitable for 24 electrodes
ch34x28={[7,8,8,10,35,36,37,38,63,64,65,66,91,92,93,94],[13,14,15,16,41,42,43,44,69,70,71,72,97,98,99,100],[19,20,21,22,47,48,49,50,75,76,77,78,103,104,105,106],[143,144,145,146,171,172,173,174,199,200,201,202,227,228,229,230],...
    [148,149,150,151,176,177,178,179,204,205,206,207,232,233,234,235],[158,159,160,161,186,187,188,189,214,215,216,217,242,243,244,245],[163,164,165,166,191,192,193,194,219,220,221,222,247,248,249,250],[286,287,288,289,314,315,316,317,342,343,344,345,370,371,372,373],[293,294,295,296,321,322,323,324,349,350,351,352,377,378,379,380],[300,301,302,303,328,329,330,331,356,357,358,359,384,385,386,387],[423,424,425,426,451,452,453,454,479,480,481,482,507,508,509,510],[429,430,431,432,457,458,459,460,485,486,487,488,513,514,515,516],...
    [437,438,439,440,465,466,467,468,493,494,495,496,521,522,523,524],[443,444,445,446,471,472,473,474,499,500,501,502,527,528,529,530],[561,562,563,564,589,590,591,592,617,618,619,620,645,646,647,648],[567,568,569,570,595,596,597,598,623,624,625,626,651,652,653,654],[573,574,575,576,601,602,603,604,629,630,631,632,657,658,659,660],[579,580,581,582,607,608,609,610,635,636,637,638,663,664,665,666],[585,586,587,588,613,614,615,616,641,642,643,644,669,670,671,672],[706,707,708,709,734,735,736,737,762,763,764,765,790,791,792,793],...
    [713,714,715,716,741,742,743,744,769,770,771,772,797,798,799,800],[720,721,722,723,748,749,750,751,776,777,778,779,804,805,806,807],[848,849,850,851,876,877,878,879,904,905,906,907,932,933,934,935],[858,859,860,861,886,887,888,889,914,915,916,917,942,943,944,945]};
Subplot_position={[0.2,0.8],[0.4, 0.8], [0.65, 0.8],[0 0.65], [0.2 0.65], [0.4 0.65], [0.6 0.65] [0.8 0.65] [0.25 0.5] [0.5 0.5], [0.75 0.5]};
Rows=34;
Columns=28;
ratio=0.5;
fig=figure('Position', [0 0 1920 1080]); 
set(gcf,'color','white')
xmin=0;
xmax=size(data,2)-1;
ymin=min(data,[],'all');
ymax=max(data,[],'all');

for channel=1:24
    for condition=1:size(data,3)
        subplot(Rows,Columns,ch34x28{1,channel})
        plot(data(channel,:,condition),'linewidth', 0.5)
        pbaspect manual
        pbaspect([1 ratio 1])
        axis manual
        ylim([ymin ymax])
        hold on
    end
    plot([51 51],[ymin,ymax],'lineWidth',0.15,'color','k')
    hold on
    plot([151 151],[ymin,ymax],'lineWidth',0.15,'color','k')
    hold on
    plot([201 201],[ymin,ymax],'lineWidth',0.15,'color','k')
    hold on
    plot([1,499], [0 0],'lineWidth',0.5,'color','k')
    title(channel_names{1,channel})
    box 'off'
    set(gca, 'xcolor', 'w')
    hold off
end
legend(condition_names,'Position', [0.8 0.15 0.1 0.15])
legend('boxoff')
end